<!-- tests-list.component.html -->
<div class="h-full flex flex-col">
  <div class="flex-1 min-h-0 overflow-auto">
    <div class="container mx-auto p-4">
      <!-- Header with Title and Add Button -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">Diagnostic Tests</h1>
        <div class="flex items-center space-x-2">
          <div *ngIf="!isMobile" class="view-toggle" role="group" aria-label="View mode">
            <button
              type="button"
              class="toggle-btn"
              [class.active]="viewMode === 'table'"
              (click)="setViewMode('table')"
              aria-label="Table view"
              title="Table view"
            >
              <mat-icon>table_rows</mat-icon>
            </button>
            <button
              type="button"
              class="toggle-btn"
              [class.active]="viewMode === 'card'"
              (click)="setViewMode('card')"
              aria-label="Card view"
              title="Card view"
            >
              <mat-icon>grid_view</mat-icon>
            </button>
          </div>
          <button (click)="add()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center space-x-2 transition-colors">
            <mat-icon class="text-white">add</mat-icon>
            <span>Add New Test</span>
          </button>
        </div>
      </div>

      <!-- Search and Filter Section -->

      <!-- Tests Table -->
      <div *ngIf="!isMobile && viewMode === 'table'" class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Price (₹)</th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let test of pagedItems" 
                  class="hover:bg-blue-50 transition-colors cursor-pointer"
                  (click)="viewTestDetails(test)">
                <!-- Test Name with Link -->
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-full bg-blue-100 text-blue-600">
                      <mat-icon>biotech</mat-icon>
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">{{ test.name }}</div>
                      <div class="text-xs text-gray-500">ID: {{ test.id }}</div>
                    </div>
                  </div>
                </td>
                
                <!-- Category -->
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                    {{ test.category }}
                  </span>
                </td>
                
                <!-- Description -->
                <td class="px-6 py-4">
                  <div class="text-sm text-gray-900 max-w-xs truncate">{{ test.description }}</div>
                </td>
                
                <!-- Price -->
                <td class="px-6 py-4 whitespace-nowrap text-right">
                  <span class="text-sm font-medium text-gray-900">₹{{ test.price }}</span>
                  <div class="text-xs text-gray-500">{{ test.tat }}</div>
                </td>
                
                <!-- Status -->
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span [ngClass]="{
                    'bg-green-100 text-green-800': test.isActive,
                    'bg-red-100 text-red-800': !test.isActive
                  }" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                    {{ test.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                
                <!-- Actions -->
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex justify-end space-x-2">
                    <button (click)="$event.stopPropagation(); edit(test)" 
                            class="text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-100"
                            matTooltip="Edit Test">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button (click)="$event.stopPropagation(); delete(test)" 
                            class="text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-100"
                            matTooltip="Delete Test">
                      <mat-icon>delete</mat-icon>
                    </button>
                    <button (click)="$event.stopPropagation(); toggleStatus(test)" 
                            class="text-gray-600 hover:text-gray-900 p-1 rounded-full hover:bg-gray-100"
                            [matTooltip]="test.isActive ? 'Deactivate Test' : 'Activate Test'">
                      <mat-icon>{{ test.isActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
                    </button>
                  </div>
                </td>
              </tr>
              
              <!-- No Results -->
              <tr *ngIf="filteredTests.length === 0">
                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                  <mat-icon class="text-4xl opacity-30 mb-2">search_off</mat-icon>
                  <p class="text-lg font-medium">No tests found</p>
                  <p class="text-sm">Try adjusting your search or filter to find what you're looking for.</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Pagination -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
          <div class="flex-1 flex justify-between sm:hidden">
            <button 
              (click)="currentPage = currentPage - 1" 
              [disabled]="currentPage === 1"
              class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
            >
              Previous
            </button>
            <button 
              (click)="currentPage = currentPage + 1" 
              [disabled]="currentPage * itemsPerPage >= totalItems"
              class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
            >
              Next
            </button>
          </div>
          <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
              <p class="text-sm text-gray-700">
                Showing <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> to 
                <span class="font-medium">{{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }}</span> of 
                <span class="font-medium">{{ totalItems }}</span> results
              </p>
            </div>
            <div>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <button 
                  (click)="currentPage = currentPage - 1" 
                  [disabled]="currentPage === 1"
                  class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                >
                  <span class="sr-only">Previous</span>
                  <mat-icon class="h-5 w-5">chevron_left</mat-icon>
                </button>
                
                <!-- Page numbers -->
                <ng-container *ngFor="let page of getPageNumbers()">
                  <button 
                    *ngIf="page !== '...'"
                    (click)="currentPage = +page"
                    [ngClass]="{
                      'z-10 bg-blue-50 border-blue-500 text-blue-600': currentPage === +page,
                      'bg-white border-gray-300 text-gray-500 hover:bg-gray-50': currentPage !== +page
                    }"
                    class="relative inline-flex items-center px-4 py-2 border text-sm font-medium"
                  >
                    {{ page }}
                  </button>
                  <span 
                    *ngIf="page === '...'"
                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"
                  >
                    {{ page }}
                  </span>
                </ng-container>
                
                <button 
                  (click)="currentPage = currentPage + 1" 
                  [disabled]="currentPage * itemsPerPage >= totalItems"
                  class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                >
                  <span class="sr-only">Next</span>
                  <mat-icon class="h-5 w-5">chevron_right</mat-icon>
                </button>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="isMobile || viewMode === 'card'" class="tests-cards">
        <div class="tests-card" *ngFor="let test of pagedItems; trackBy: trackByTestId" (click)="viewTestDetails(test)" tabindex="0">
          <div class="tests-card-header">
            <div class="tests-card-title">
              <div class="tests-card-name">{{ test.name }}</div>
              <div class="tests-card-id">ID: {{ test.id }}</div>
            </div>
            <span [ngClass]="{ 'bg-green-100 text-green-800': test.isActive, 'bg-red-100 text-red-800': !test.isActive }" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
              {{ test.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>

          <div class="tests-card-body">
            <div class="tests-card-meta">
              <span class="meta-label">Category</span>
              <span class="meta-value">{{ test.category }}</span>
            </div>
            <div class="tests-card-meta">
              <span class="meta-label">Price</span>
              <span class="meta-value">₹{{ test.price }}</span>
            </div>
            <div class="tests-card-meta">
              <span class="meta-label">TAT</span>
              <span class="meta-value">{{ test.tat }}</span>
            </div>
            <div class="tests-card-meta">
              <span class="meta-label">Description</span>
              <span class="meta-value">{{ test.description }}</span>
            </div>
          </div>

          <div class="tests-card-actions">
            <button (click)="$event.stopPropagation(); edit(test)" class="text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-100" matTooltip="Edit Test">
              <mat-icon>edit</mat-icon>
            </button>
            <button (click)="$event.stopPropagation(); delete(test)" class="text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-100" matTooltip="Delete Test">
              <mat-icon>delete</mat-icon>
            </button>
            <button (click)="$event.stopPropagation(); toggleStatus(test)" class="text-gray-600 hover:text-gray-900 p-1 rounded-full hover:bg-gray-100" [matTooltip]="test.isActive ? 'Deactivate Test' : 'Activate Test'">
              <mat-icon>{{ test.isActive ? 'toggle_on' : 'toggle_off' }}</mat-icon>
            </button>
          </div>
        </div>

        <div class="tests-empty" *ngIf="filteredTests.length === 0">
          <mat-icon class="text-4xl opacity-30 mb-2">search_off</mat-icon>
          <p class="text-lg font-medium">No tests found</p>
          <p class="text-sm">Try adjusting your search or filter to find what you're looking for.</p>
        </div>

        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6" *ngIf="totalItems > 0">
          <div class="flex-1 flex justify-between sm:hidden">
            <button
              (click)="currentPage = currentPage - 1"
              [disabled]="currentPage === 1"
              class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
            >
              Previous
            </button>
            <button
              (click)="currentPage = currentPage + 1"
              [disabled]="currentPage * itemsPerPage >= totalItems"
              class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
            >
              Next
            </button>
          </div>
          <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
              <p class="text-sm text-gray-700">
                Showing <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> to
                <span class="font-medium">{{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }}</span> of
                <span class="font-medium">{{ totalItems }}</span> results
              </p>
            </div>
            <div>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <button
                  (click)="currentPage = currentPage - 1"
                  [disabled]="currentPage === 1"
                  class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                >
                  <span class="sr-only">Previous</span>
                  <mat-icon class="h-5 w-5">chevron_left</mat-icon>
                </button>

                <ng-container *ngFor="let page of getPageNumbers()">
                  <button
                    *ngIf="page !== '...'"
                    (click)="currentPage = +page"
                    [ngClass]="{
                      'z-10 bg-blue-50 border-blue-500 text-blue-600': currentPage === +page,
                      'bg-white border-gray-300 text-gray-500 hover:bg-gray-50': currentPage !== +page
                    }"
                    class="relative inline-flex items-center px-4 py-2 border text-sm font-medium"
                  >
                    {{ page }}
                  </button>
                  <span
                    *ngIf="page === '...'"
                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"
                  >
                    {{ page }}
                  </span>
                </ng-container>

                <button
                  (click)="currentPage = currentPage + 1"
                  [disabled]="currentPage * itemsPerPage >= totalItems"
                  class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                >
                  <span class="sr-only">Next</span>
                  <mat-icon class="h-5 w-5">chevron_right</mat-icon>
                </button>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>